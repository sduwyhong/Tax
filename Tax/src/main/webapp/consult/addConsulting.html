<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>安徽省国家税务局税企互助交流平台</title>
<meta http-equiv="pragma" content="no-cache">
<meta http-equiv="cache-control" content="no-cache">
<meta http-equiv="expires" content="0">
<meta http-equiv="keywords" content="keyword1,keyword2,keyword3">
<meta http-equiv="description" content="Simple">
<!--  360浏览器专用 -->
<meta name="renderer" content="ie-stand">
<link rel="shortcut icon" href="../image/project.ico" type="image/x-icon">
<link rel="stylesheet" type="text/css" href="../css/consult/consultingShare.css">
<link rel="icon" href="../image/home/favicon.gif" type="image/x-icon">
<link rel="stylesheet" href="../css/zeroModal.css">
<link rel="stylesheet" type="text/css" href="../css/scayt.css">
<link rel="stylesheet" type="text/css" href="../css/wsc.css">
<link rel="stylesheet" type="text/css" href="http://58.56.96.171:8009/lagsms/resources/ckeditor/skins/moono-lisa/editor.css?t=H0CG">
<script type="text/javascript" src="../ckeditor/ckeditor.js"></script>
<script type="text/javascript" src="../ckeditor/config.js"></script>
<script type="text/javascript" src="../ckeditor/lang/zh-cn.js"></script>
<script type="text/javascript" src="../ckeditor/styles.js"></script>
<script type="text/javascript" src="../js/path.js"></script>

<style>
.cke {
	visibility: hidden;
}
</style>


</head>
<body>
	<style type="text/css">
body {
	min-height: 900px;
	background: #eee;
}

.header {
	width: 100%;
	height: 100px;
	display: -webkit-box;
	position: relative;
	min-width: 1200px;
	background: rgba(255, 255, 255, 255);
}

.header .logo {
	width: 614px;
	height: 42px;
	background: url(../image/home/logo.png) no-repeat;
	position: relative;
	background-size: 100% 100%;
	margin: 30px 30px;
}

.header .nav {
	-webkit-box-flex: 1;
	width: 750px;
	margin-right: 70px;
}

.header .nav ul {
	display: -webkit-box;
	list-style: none;
}

.header .nav ul li {
	-webkit-box-flex: 1;
	line-height: 100px;
	font-size: 16px;
	text-align: center;
	height: 85px;
	width: 85px;
}

.header .nav ul li a {
	text-decoration: none;
	font-size: 19px;
	color: #2057a6;
}

.header .but {
	width: 185px;
	height: 100px;
	position: relative;
	overflow: hidden;
	box-sizing: content-box;
}

.but_content {
	width: 150px;
	height: 100px;
	position: absolute;
	bottom: 0;
}

.but_content div {
	float: left;
	height: 20px;
	line-height: 83px;
	color: #1B55A9;
	cursor: pointer;
	font-size: 15px;
	text-align: right;
}

.but_content div a {
	color: #1B55A9;
	font-size: 15px;
	text-decoration: none;
}

.message {
	width: 14px;
	cursor: pointer;
}

.your_meaasge span {
	color: #1B55A9;
}

.your_meaasge {
	height: 23px;
	position: absolute;
	margin-top: 55px;
	z-index: 999;
	margin-left: 15px;
}

.newss {
	color: #1B55A9;
	text-decoration: none;
	cursor: pointer;
}

/*	导航栏搜索	*/
/*new*/
.s_wrap {
	width: 145px;
	height: 30px;
	border: 1px solid #1B55A9;
	line-height: 100px;
	margin-top: 33px;
	border-radius: 7px;
	margin-left: 10px;
}

.magnifying {
	width: 18px;
	height: 18px;
	float: left;
	margin: 6px 10px;
	cursor: pointer;
}

.ssearch {
	float: right;
	width: 76px;
	height: 30px;
	border: none;
	border-left: 1px solid #1B55A9;
	box-sizing: border-box;
	margin: 0px 28px 0 0;
	padding-left: 8px;
	color: #1B55A9;
	resize: none;
	outline: none;
	background: none;
}

.person {
	width: 35px;
	height: 35px;
	margin-top: 22px;
}

@media screen and (max-width: 1440px) {
	.header .logo {
		width: 720px;
		height: 34px;
		background: url(../image/header/520.png) no-repeat;
		position: relative;
		background-size: 100% 100%;
		margin: 35px 30px;
	}
	.header .nav ul li a {
		text-decoration: none;
		color: #1B55A9;
		font-size: 19px;
	}
}

@media screen and (max-width: 1366px) {
	.header .logo {
		width: 720px;
		height: 34px;
		background: url(../image/header/520.png) no-repeat;
		position: relative;
		background-size: 100% 100%;
		margin: 35px 30px;
	}
	.header .nav ul li a {
		text-decoration: none;
		color: #1B55A9;
		font-size: 18px;
	}
}

@media screen and (max-width: 1280px) {
	.header .logo {
		width: 640px;
		height: 32px;
		background: url(../image/header/490.png) no-repeat;
		position: relative;
		background-size: 100% 100%;
		margin: 35px 30px;
	}
	.header .nav ul li a {
		text-decoration: none;
		color: #1B55A9;
		font-size: 17px;
	}
}

@media screen and (max-width: 1024px) {
	.header .logo {
		width: 480px;
		height: 24px;
		background: url(../image/header/380.png) no-repeat;
		position: relative;
		background-size: 100% 100%;
		margin: 40px 35px;
	}
	.header .nav ul li a {
		text-decoration: none;
		color: #1B55A9;
		font-size: 15px;
	}
}
/* .logo,.nav,.but{
	border:1px solid;
}  */
</style>


	<!-- header start -->
	<div id="headerpage"></div>
	<!-- header end -->
<!-- load js -->
	<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
	<script type="text/javascript" src="../js/zeroModel.min.js" charset="utf-8"></script>
	<script type="text/javascript" src="../js/Materialize/materialize.min.js"></script>
	<script type="text/javascript" src="../js/Materialize/adbeus.js"></script>
	<script type="text/javascript" src="http://58.56.96.171:8009/lagsms/resources/ckeditor/config.js?t=H0CG"></script>
	<script type="text/javascript" src="http://58.56.96.171:8009/lagsms/resources/ckeditor/lang/zh-cn.js?t=H0CG"></script>
	<script type="text/javascript" src="http://58.56.96.171:8009/lagsms/resources/ckeditor/styles.js?t=H0CG"></script>

	<script>
			// 窗体加载完成时轮询
			/*
			var t, notifyNum = 0;
			window.onload = function() {
				loadNotifies();
				t = setInterval(loadNotifies, 10000); //每10秒执行一次
			}
			// 窗体关闭之前清除此定时器
			window.onbeforeunload = function() {
				clearInterval(t);
			}
			*/
			//消息提示
			function loadNotifies() {
				var param = {
					pagingOrNot : "not",
					readOrUnread : "0"
				};
				// 获取所有的通知
				$.get('/lagsms/notifies/count', param, function(data) {
					if(notifyNum == data) {
						return;
					}
					notifyNum = data;
					var numTxt = "";
					if(notifyNum >= 100) {
						numTxt = "99+";
					} else if(notifyNum == 0) {
						numTxt = "";
					}
					$("#news").text(numTxt);
				});
			}
		</script>

	<script>
        $(function(){
           $(".user_text").hover(function(){
               var width_a = $(this).width();
               var width_b = $(this).find(".user_id").width();
               var indent_px = width_a - width_b;
               if( width_a <= width_b ){
                   $(this).css("text-indent",indent_px);
               }
           },function(){
               $(this).css("text-indent","0");
           });
        });
    </script>
	<!-- input点击清除value值 -->
	<script type="text/javascript">
		wap_val = [];
		$(".ssearch").each(function(i) {
			wap_val[i] = $(this).val();
			$(this).focusin(function() {
				if ($(this).val() == wap_val[i]) {
					$(this).val("");
				}
			}).focusout(function() {
				if ($.trim($(this).val()) == "") {
					$(this).val(wap_val[i]);
				}
			});
		});
		//  用户名显示
		 $(".user_id").each(function(){
		  var maxwidth=4;
		  if($(this).text().length > maxwidth){
		    $(this).text($(this).text().substring(0,maxwidth));
		    $(this).html($(this).html()+'...');
		  }
		}); 
	</script>


	<!-- 头部标题end -->
	<div class="content">
		<div class="content_main">
			<div class="content_top">我要咨询</div>
			<div class="gary">
				<div class="darkblue"></div>
			</div>
			<div class="content_middle">
				<form id="consultingShareForm" method="post"
					onsubmit="return save();" action="/lagsms/question/addConsulting">
					<div>
						<div>
							<input type="text" name="userId" id="userId" hidden="true">
						</div>
						<div>
							<input type="text" name="status" id="status" hidden="true">
						</div>
						<div>
							<input type="text" name="browseCount" id="browseCount"
								hidden="true">
						</div>
						
						<!-- 下拉框start -->
						<div class="content_middle_one">
							<label style="font-size:18px;color:#000000b3;margin-right:60px;">选择类型</label> 
							<select id="category" class="browser-default" style="color:#000000b3;display:inline-block;width:auto;min-width:70px;padding-right:20px">
								<option value="">普通提问</option>
								<option value="1">悬赏提问</option>
							</select>
							<label style="font-size:17px;color:#000000b3;margin-right:20px;">悬赏金额</label> 
							<select id="rewardAmount" class="browser-default" style="color:#000000b3;display:inline-block;width:auto;min-width:70px;padding-right:20px">
								<option value="" disabled selected>自选积分金额</option>
								<option value="1">1</option>
								<option value="3">3</option>
								<option value="5">5</option>								
								<option value="10">10</option>								
								<option value="15">15</option>								
								<option value="20">20</option>								
							</select>
						</div>
						<!-- 下拉框start -->

						<!-- 复选框start -->
						<div class="content_middle_two">
							<div class="select_f">
								<span>选择专业分类:</span>
							</div>
							<div class="select_btn" style="display:inline-block;">
									<form action="#" id="majorForm" method="GET">
										<input type="checkbox" id="1" value="1" name="majorCategory" onclick="selectedMajor();"><label for="1">发票系统故障及操作指导</label>
										<input type="checkbox" id="2" value="2" name="majorCategory" onclick="selectedMajor();"><label for="2">发票领购</label>
										<input type="checkbox" id="3" value="3" name="majorCategory" onclick="selectedMajor();"><label for="3">发票代开</label>
										<input type="checkbox" id="4" value="4" name="majorCategory" onclick="selectedMajor();"><label for="4">发票开具</label>
										<input type="checkbox" id="5" value="5" name="majorCategory" onclick="selectedMajor();"><label for="5">红字增值税发票开具</label>
										<input type="checkbox" id="6" value="6" name="majorCategory" onclick="selectedMajor();"><label for="6">申报有误能否作废</label>
										<input type="checkbox" id="7" value="7" name="majorCategory" onclick="selectedMajor();"><label for="7">一般纳税人资格</label>
										<input type="checkbox" id="8" value="8" name="majorCategory" onclick="selectedMajor();"><label for="8">辅导期一般纳税人</label>
										<input type="checkbox" id="9" value="9" name="majorCategory" onclick="selectedMajor();"><label for="9">专用发票认证抵扣</label>
										<input type="checkbox" id="10" value="10" name="majorCategory" onclick="selectedMajor();"><label for="10">小规模纳税人增值税起征点是否有调整</label>
										<input type="checkbox" id="11" value="11" name="majorCategory" onclick="selectedMajor();"><label for="11">认定为一般纳税人之后是否可以转为小规模纳税人</label>
										<input type="checkbox" id="12" value="12" name="majorCategory" onclick="selectedMajor();"><label for="12">小规模纳税人自行开具的增值税专用发票如何填写申报表</label>
										<input type="checkbox" id="13" value="13" name="majorCategory" onclick="selectedMajor();"><label for="13">注销登记</label>
										<input type="checkbox" id="14" value="14" name="majorCategory" onclick="selectedMajor();"><label for="14">发票检查</label>
										<input type="checkbox" id="15" value="15" name="majorCategory" onclick="selectedMajor();"><label for="15">专用发票丢失</label>
										<input type="checkbox" id="16" value="16" name="majorCategory" onclick="selectedMajor();"><label for="16">征收率</label>
										<input type="checkbox" id="17" value="17" name="majorCategory" onclick="selectedMajor();"><label for="17">非国税业务</label>
										<input type="checkbox" id="18" value="18" name="majorCategory" onclick="selectedMajor();"><label for="18">信用等级</label>
										<input type="checkbox" id="19" value="19" name="majorCategory" onclick="selectedMajor();"><label for="19">营改增</label>
										<input type="checkbox" id="20" value="20" name="majorCategory" onclick="selectedMajor();"><label for="20">金税管理</label>
										<input type="checkbox" id="21" value="21" name="majorCategory" onclick="selectedMajor();"><label for="21">进出口税收</label>
										<input type="checkbox" id="22" value="22" name="majorCategory" onclick="selectedMajor();"><label for="22">征收管理</label>
										<input type="checkbox" id="23" value="23" name="majorCategory" onclick="selectedMajor();"><label for="23">发票保管</label>
									</form>
							</div>
						</div>
						<!-- 复选框end -->
						
						<div style="clear: both;"></div>
						<div style="clear: both;"></div>
						
						<!-- 根据复选框 弹出可邀请的用户start -->
						<div class="content_middle_three">
							<span>邀请回答:</span>
							<div class="Org fr" style="margin-top: -8px;" id="org">
								<div class="clearfix" >
									<label class="ordinary fl" style="font-size:17px;color:#000000b3;">相关用户:</label>
									<div id="ordinary" class="ordinaryone fl">
										<span class="candidates" hidden="hidden"><input type="checkbox" id="user_1513161259431" value="userId" name="invitedId" class="type_item"><label for="user_1513161259431">admin6</label></span>
									</div>
								</div>
								<!-- 
								<div class="clearfix">
									<label class="expert fl" style="font-size:17px;color:#000000b3;">专家用户:</label>
									<div id="expert" class="expertone fl">
										<input type="checkbox" id="u0001" name="invitedId" class="type_item"><label for="u0001">管理员</label>
										<input type="checkbox" id="user_1513161147650" name="invitedId" class="type_item"><label for="user_1513161147650">admin3</label>
									</div>
								</div>
								<div class="clearfix">
									<label class="institution fl" style="font-size:17px;color:#000000b3;">机构用户:</label>
									<div id="institution" class="institutionone fl">
										<input type="checkbox" id="user_1513161052281" name="invitedId" class="type_item"><label for="user_1513161052281">税务人员</label>
										<input type="checkbox" id="user_1513161100659" name="invitedId" class="type_item"><label for="user_1513161100659">admin2</label>
									</div>
								</div>
								 -->
							</div>
							<div style="clear: both;"></div>
						</div>
						<!-- 根据复选框 弹出可邀请的用户start -->
						
						<!-- 文本编辑start -->
						<!-- 标题 -->
						<div class="add_title clearfix">
							<div class="title_one fl"
								style="margin-top: 20px; font-size: 18px; margin-right: 15px;">标&emsp;&emsp;题:</div>
							<input name="title" id="title" class="title_input fl" style="height: 22px; margin-top: 20px">
						</div>
						<div class="add_content clearfix">
							<div class="text_area">
								<!-- <textarea name="content" id="content" class="fl" style="height:180px;"></textarea> -->
								<textarea name="content" id="editor" class="fl" cols="30"
									rows="10" style="visibility: hidden; display: none;"></textarea>
								<script type="text/javascript">
									CKEDITOR.replace('editor')
								</script>
							</div>
						</div>
						<!-- 文本编辑start -->
						
						<div class="sub">
							<input type="button" onclick="save()" value="提交" class="button_submit pr">
						</div>
					</div>
				</form>
			</div>
		</div>
	</div>
	
	<!-- footer start -->
	<div id = "footerpage"></div>
	<!-- footer end -->
	
	<!-- load header and footer -->
	<script type="text/javascript">
		$("#headerpage").load("../header.html");
		$("#footerpage").load("../footer.html");
	</script>
	
	
	<script type="text/javascript">
		
		//如果是悬赏就不禁用 否则就禁用
		function selectCategory() {
			var target = event.target;
		 	if(target.value == '1') { //悬赏提问
		 		var rewardAmount = document.getElementById("rewardAmount");
			 	rewardAmount.value = "";
			 	rewardAmount.disabled = false;
		 	} else {
		 		var rewardAmount = document.getElementById("rewardAmount");
			 	rewardAmount.disabled = true;
		 	}
	 	}
	
		// 存放所有选中的mojor
		var selectedMajors = new Set();
		function selectedMajor() {
			// 为了兼容firefox
			var e =  window.event || arguments.callee.caller.arguments[0];
			if(e.target.checked) {
				selectedMajors.add(e.target.value);
			} else {
				selectedMajors.delete(e.target.value);
			}
			// ajax 请求
			var m = Array.from(selectedMajors).join(';');
			m = encodeURI(m);
			console.log(m);
			$('.candidates[hidden!=hidden]').remove();
			if(m.length > 0){
				$.ajax({
					url:path+'user/getUserByPro',
					data:{
						proId:m
					},
					success:function(data){
						console.log(data);
						/*<span class="candidates" hidden="hidden"><input type="checkbox" id="user_1513161259431" value="userId" name="invitedId" class="type_item"><label for="user_1513161259431">admin6</label></span>*/
						var users = data.result;
						//clear
						for(var i in users) {
							var template = $('.candidates:first').clone();
							var random = Math.random();
							var input = template.children('input');
							input.attr('id',random);
							input.val(users[i].id);
							var label = template.children('label');
							label.text(users[i].username);
							label.attr('for',random);
							template.removeAttr('hidden');
							$('.candidates:last').after(template);
						}
					}
				})
			}
		}
	
		 function save() {
			//下拉框校验
			/* var myselect=document.getElementById("category");
			if(null==myselect.selectedIndex||myselect.selectedIndex==""){
				zeroModal.alert("请选择类型");
				return false;
			} */
			
			var rewardAmount = document.getElementById("rewardAmount");
			if(parseInt(rewardAmount.value) > parseInt('100')) {
				zeroModal.alert("您的积分不足");
				return false;
			}
			
			//复选框校验
			var str=document.getElementsByName("majorCategory");
			var objarray=str.length;
			var chestr="";
			for (i=0;i<objarray;i++) {
			  	if(str[i].checked == true) {
			   		chestr+=str[i].value+";";
			  	}
			}
			chestr = chestr.substr(0,chestr.length-1);
			console.log(chestr);
			if(chestr == "") {
				alert("请先选择一个专业");
			  	return false;
			}
			
			var strone=document.getElementsByName("invitedId");
			var objarrayone=strone.length;
			var chestrone="";
			for (i=0;i<objarrayone;i++) {
			  if(strone[i].checked == true) {
				  chestrone+=strone[i].value+";";
			  }
			}
			chestrone = chestrone.substr(0,chestrone.length-1);
			console.log(chestrone);
			/*
			if(chestrone == "") {
				alert("请先选择一个用户");
			  return false;
			}
			*/
			//输入框校验
			var text = document.getElementById('title').value
			console.log(text.trim());
			/* text.replace(/\ +/g, ""); //去掉空格
	        text.replace(/[ ]/g, "");    //去掉空格
	        text.replace(/[\r\n]/g, ""); //去掉回车换行  */
			if (null == text || text == "") {
				alert("请填写标题");
				return false;
			}
			//文本域校验
			//CKEDITOR.instances.控件ID.getData();
			var content = CKEDITOR.instances.editor.getData();
			console.log(content.trim());
			/* text.replace(/\ +/g, ""); //去掉空格
	        text.replace(/[ ]/g, "");    //去掉空格
	        text.replace(/[\r\n]/g, ""); //去掉回车换行  */
			if (null == content || content == "") {
				alert("请填写正文");
				return false;
			}
	        //是否登录用户校验
			var userId='user_1530497588928';
			console.log(userId);
			if(userId=='null'){
				alert("请先登录用户");
				return false;
			}
			var prize = $('#rewardAmount').val();
			if(prize == undefined || prize < 1){
				prize = 0;
			}
			$.ajax({
				url:path+'user/question',
				type:'post',
				data:{
					prize:prize,
					type:chestr,
					invitationList:chestrone,
					title:$('input[name=title]').val(),
					content:content
				},
				success:function(data){
					console.log(data);
					if(data.status == 400){
						alert('参数有误！');
					}else if(data.status == 200){
						alert('提交成功！');
						location.href = 'questions.html';
					}
				}
			})
       }
	</script>
	
</body>
</html>